<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corona Info</title>
    <link rel="stylesheet" type="text/css" href="table.css">
</head>
<body>
    <table style="width:100%" id = "statsTable">
        <tr>
          <th>Country</th>
          <th>Confirmed</th> 
          <th>Deaths</th>
          <th>Recovered</th>
        </tr>
        
      </table>

    <script>
        const api_url = "https://coronavirus-tracker-api.herokuapp.com/v2/locations";

        makeTable();

        async function makeTable(){
            const dataObj = await getData(); 
            console.log(dataObj)
            let statsTable = document.getElementById('statsTable')

            for (id in dataObj){

                country_name = dataObj[id].country
                confirmed = dataObj[id].confirmed
                deaths = dataObj[id].deaths
                recovered = dataObj[id].recovered

                const row = statsTable.insertRow();

                const cell1 = row.insertCell(0);
                cell1.innerHTML = country_name

                const cell2 = row.insertCell(1);
                cell2.innerHTML = confirmed

                const cell3 = row.insertCell(2);
                cell3.innerHTML = deaths

                const cell4 = row.insertCell(3);
                cell4.innerHTML = recovered
                

            }
        }
        
        async function getData(){
            const response = await fetch(api_url);
            const data = await response.json();
            
            //start with global data
            const dataObj = [
                {
                country: "Global",
                confirmed : data.latest.confirmed,
                deaths : data.latest.deaths,
                recovered: data.latest.recovered
                }
            ]
            
            //loop thru and store all data
            for (id in data.locations){
                country_data = data.locations[id]
                cases_info = country_data.latest
                country_name = country_data.country

                cases_info["country"] = country_name
                dataObj.push(cases_info)

            } 
            //sort data by confirmed cases
            dataObj.sort(function(a, b){
                return b.confirmed - a.confirmed
            })
            return dataObj
            
        }
        
        // console.log(dataObj);
        // console.log(dataObj)

        // setInterval(getData, 20000);
    </script>
    
</body>
</html>