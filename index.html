<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>rona19</title>
    <link rel="stylesheet" type="text/css" href="table.css">
    <link rel="stylesheet" type="text/css" href="tabs.css">
    <link href="https://fonts.googleapis.com/css?family=Quicksand&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Rubik&display=swap" rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    <script src = "https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.3.4/js/tether.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.3/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    
</head>
<body id = "full-back">
    <div class="topnav" id = "navbar">
        <div id = "logodiv">
            <img src="virus.png" width = 50 height = 50 style="max-width:100%;max-height:100%;">
            <span id = "logotext">rona19</span>   
        </div>
        <div id ="links">
            <a href="#about">About</a>
            <a href="#whatis">What is COVID-19?</a>
            <a href="/analytics">Analytics</a>
            <a href="#data" >Data</a>
        </div>
       
    </div>

    <div class = "home" id = "data">
        <div class = "white-background">
            <div id = "live">
                <span class = "updates">Latest Updates</span>
                <button class="dropbtn">Global</button>
            </div>
            <div class = "fullBox">
                <div id = "reddiv" class = "box">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/5a/Red_check.svg" width = 40 height = 40>
                    <span id="confirmed" class = "child">0</span> 
                </div>
                <div class ="base" id = "red_base">
                    <span>Confirmed</span>
                </div>   
            </div>
            <div class = "fullBox">
                <div id = "graydiv" class = "box">
                    <svg xmlns="http://www.w3.org/2000/svg" width = 40 height = 40 viewBox="0 0 448 512"><path fill = "rgb(105, 103, 103)" d="M439.15 453.06L297.17 384l141.99-69.06c7.9-3.95 11.11-13.56 7.15-21.46L432 264.85c-3.95-7.9-13.56-11.11-21.47-7.16L224 348.41 37.47 257.69c-7.9-3.95-17.51-.75-21.47 7.16L1.69 293.48c-3.95 7.9-.75 17.51 7.15 21.46L150.83 384 8.85 453.06c-7.9 3.95-11.11 13.56-7.15 21.47l14.31 28.63c3.95 7.9 13.56 11.11 21.47 7.15L224 419.59l186.53 90.72c7.9 3.95 17.51.75 21.47-7.15l14.31-28.63c3.95-7.91.74-17.52-7.16-21.47zM150 237.28l-5.48 25.87c-2.67 12.62 5.42 24.85 16.45 24.85h126.08c11.03 0 19.12-12.23 16.45-24.85l-5.5-25.87c41.78-22.41 70-62.75 70-109.28C368 57.31 303.53 0 224 0S80 57.31 80 128c0 46.53 28.22 86.87 70 109.28zM280 112c17.65 0 32 14.35 32 32s-14.35 32-32 32-32-14.35-32-32 14.35-32 32-32zm-112 0c17.65 0 32 14.35 32 32s-14.35 32-32 32-32-14.35-32-32 14.35-32 32-32z"/></svg>
                    <span id="dead" class = "child">0</span>
                </div>
                <div class ="base" id = "gray_base">
                    <span>Deaths</span>
                </div>   
            </div>

            <div class = "fullBox">
                <div id = "greendiv" class = "box">
                    <svg version="1.0" xmlns="http://www.w3.org/2000/svg" width = 40 height = 40
                    viewBox="0 0 1280.000000 1280.000000"
                    preserveAspectRatio="xMidYMid meet">
                    <g transform="translate(0.000000,1280.000000) scale(0.100000,-0.100000)"
                    fill="rgb(50, 148, 47)" stroke="none">
                    <path d="M6115 12794 c-281 -20 -371 -28 -500 -45 -1615 -210 -3089 -1010
                    -4112 -2232 -788 -941 -1294 -2104 -1452 -3337 -37 -289 -46 -430 -46 -780 0
                    -510 39 -870 146 -1359 329 -1499 1203 -2865 2404 -3754 988 -732 2109 -1155
                    3360 -1269 183 -17 787 -17 970 0 678 62 1288 206 1890 447 1650 661 2916
                    1933 3570 3585 237 599 376 1193 437 1865 17 183 17 787 0 970 -94 1030 -396
                    1967 -910 2825 -1044 1739 -2857 2868 -4926 3066 -149 14 -715 27 -831 18z
                    m650 -424 c1286 -87 2497 -573 3500 -1406 167 -139 560 -532 699 -699 318
                    -383 558 -751 776 -1190 139 -280 222 -475 313 -743 437 -1271 437 -2593 0
                    -3864 -204 -596 -510 -1176 -883 -1673 -172 -230 -308 -385 -544 -621 -457
                    -457 -902 -782 -1471 -1075 -875 -451 -1800 -679 -2755 -679 -1398 0 -2763
                    500 -3865 1416 -167 139 -560 532 -699 699 -318 383 -558 751 -776 1190 -139
                    280 -222 475 -313 743 -437 1271 -437 2593 0 3864 91 268 174 463 313 743 218
                    439 458 807 776 1190 139 167 532 560 699 699 927 770 2043 1249 3221 1381
                    301 34 718 44 1009 25z"/>
                    <path d="M4650 9450 l0 -1260 -1245 -2 -1245 -3 -3 -1773 -2 -1772 1248 0
                    1247 0 0 -1235 0 -1235 1775 0 1775 0 0 1235 0 1235 1250 0 1250 0 0 1775 0
                    1775 -1250 0 -1250 0 0 1260 0 1260 -1775 0 -1775 0 0 -1260z"/>
                    </g>
                    </svg>

                    <span id="recovered" class = "child">0</span>
                </div>
                <div class ="base" id = "green_base">
                    <span>Recovered</span>
                </div>   
            </div>
            
        </div>
        
        <div id = "graphdiv" height = 400px>
            <canvas id = "chart" ></canvas>
        </div>

        <div id = "tableContainer">
            <div id = primary-text>
                <span>COVID-19 Countries</span>
            </div>
            <div id = "tbldiv">
                <table id = "statsTable">
                    <tr>
                    <th>Country</th>
                    <th>Confirmed</th> 
                    <th>Deaths</th>
                    <th>Recovered</th>
                    </tr>
                    
                </table>
            </div>
        </div>
    </div>
    <div id = "whatis" class = "anchor">
        <div id = "container">
            <div id = "myinfo" >
                <div id = "name-photo">
                    <h1 style = "margin-top: 40px; text-align: center; font-size: 4vw; font-family: Quicksand; font-weight: bolder; height: 65px;">
                        What is COVID-19?
                    </h1>
                    <div id = infotext style="margin-top: 20px; text-align: center; font-size:1.3vw; color: rgb(0, 0, 0); font-family: Quicksand; display: grid; ">
                        <span> Sources are listed in 
                            <a href="#about" style = "color:black; font-style: oblique; font-weight: bolder;">About</a>  
                            section.
                        </span>
                    </div>
    
                    <div class="tab">
                        <button class="tablinks" onclick="openTab(event, 'Overview')" id = "default" >Overview</button>
                        <button class="tablinks" onclick="openTab(event, 'Prevention')">Prevention</button>
                        <button class="tablinks" onclick="openTab(event, 'Symptoms')">Symptoms</button>
                        </div>
                        
                        <div id="Overview" class="tabcontent">
                        <h3>Overview</h3>
                        <p>Overview Text</p>
                        </div>
                        
                        <div id="Prevention" class="tabcontent">
                        <h3>Prevention</h3>
                        <p>Prevention Text</p> 
                        </div>
                        
                        <div id="Symptoms" class="tabcontent">
                        <h3>Symptoms</h3>
                        <p>Symptoms Text</p>
                        </div>
                        
                        <script>
                            document.getElementById("default").click()
                            function openTab(evt, tabName) {
                                var i, tabcontent, tablinks;
                                tabcontent = document.getElementsByClassName("tabcontent");
                                for (i = 0; i < tabcontent.length; i++) {
                                tabcontent[i].style.display = "none";
                                }
                                tablinks = document.getElementsByClassName("tablinks");
                                for (i = 0; i < tablinks.length; i++) {
                                tablinks[i].className = tablinks[i].className.replace(" active", "");
                                }
                                document.getElementById(tabName).style.display = "block";
                                evt.currentTarget.className += " active";
                            }
                      </script>
                   
                </div>
                
            </div>
            
            <div id = "abouttext" >
                <h1 style="color: maroon; font-size: 50px; text-align: center; padding-top: 25px; font-weight: bolder; font-family: Rubik;" >
                    Sources
                </h1>
                <div id = infotext style="margin-top: 30px; font-size: 30px; font-family: Quicksand; display: grid; text-align: center ">
                    <a href = "https://www.who.int/emergencies/diseases/novel-coronavirus-2019" target = "_blank" style = "color: black"> World Health Organization (WHO) </a>
                    <a href = "https://coronavirus.jhu.edu/" target = "_blank" style = "color: black"> John Hopkins University (JHU)</a>
                    <a href = "https://www.cdc.gov/coronavirus/2019-ncov/index.html" target = "_blank" style = "color: black"> Centers for Disease Control and Prevention (CDC) </a>
                </div>

            </div>
        </div>
    </div>
    <div id = "about" class = "anchor">
        <div id = "container">
            <div id = "myinfo" >
                <div id = "name-photo" style = "display: flex;">
                    <a href="https://github.com/rashadphil/corona-tracker" target="_blank">
                        <img src="https://avatars2.githubusercontent.com/u/20783686?v=4" id = "imghover" width = 250 height = 250 style = "border-radius: 50%; margin-top: 80px; margin-left: 60px;">
                    </a>
                    <h1 style = "margin-top: 90px; margin-left: 50px; font-size: 5.5vw; font-family: Quicksand; font-weight: bolder; height: 100px">Rashad Philizaire</h1>
                    <div id = infotext style="margin-top: 200px; margin-left: -43vw; font-size:1.8vw; color: rgb(121, 121, 121); font-family: Quicksand; display: grid; ">
                        <span> Student at Thomas Jefferson High School For Science and Technology</span>
                        <span> Email me with ideas at philizairer@gmail.com </span>
                    </div>
                </div>
                
            </div>
            
            <div id = "abouttext">
                <h1 style="color: maroon; font-size: 50px; text-align: center; padding-top: 25px; font-weight: bolder; font-family: Rubik;" >
                    Sources
                </h1>
                <div id = infotext style="margin-top: 30px; font-size: 30px; font-family: Quicksand; display: grid; text-align: center ">
                    <a href = "https://www.who.int/emergencies/diseases/novel-coronavirus-2019" target = "_blank" style = "color: black"> World Health Organization (WHO) </a>
                    <a href = "https://coronavirus.jhu.edu/" target = "_blank" style = "color: black"> John Hopkins University (JHU)</a>
                    <a href = "https://www.cdc.gov/coronavirus/2019-ncov/index.html" target = "_blank" style = "color: black"> Centers for Disease Control and Prevention (CDC) </a>
                </div>

            </div>
        </div>
    </div>

    <script>
        
        const api_url = "https://corona.lmao.ninja/countries?sort=%7Bparameter%7D";
        const latest_api = "https://corona.lmao.ninja/all";
        const historical_url = "https://corona.lmao.ninja/v2/historical";
        makeTable();
        makeGraph();

        async function makeTable(){
            var dataObj = await getData(); 
            //only displaying first few countries
            dataObj = dataObj.slice(0, 16)
            console.log(dataObj)
            let statsTable = document.getElementById('statsTable')

            for (id in dataObj){

                country_name = dataObj[id].country
                confirmed = dataObj[id].confirmed
                deaths = dataObj[id].deaths
                recovered = dataObj[id].recovered
                flag = dataObj[id].flag

                const row = statsTable.insertRow();

                const cell1 = row.insertCell(0);
                cell1.innerHTML = "<img src= " + flag +  " width = '30' height = '20' >" + country_name 

                //toLocaleString places commas appropriately
                
                const cell2 = row.insertCell(1);
                cell2.innerHTML = confirmed.toLocaleString()

                const cell3 = row.insertCell(2);
                cell3.innerHTML = deaths.toLocaleString()

                const cell4 = row.insertCell(3);
                cell4.innerHTML = recovered.toLocaleString()

                cell1.id = "country"
                cell2.id = "data";
                cell3.id = "data";
                cell4.id = "data";

            }
        }
        
        async function makeGraph() {
            const data = await getHistoricalData();
            console.log(data)
            const ctx = document.getElementById('chart').getContext('2d');
            
            const myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.xs,
                    datasets: [{
                        label: 'Confirmed cases',
                        data: data.cases_ys,
                        fill: true,
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 5,
                    }, {
                        label: 'Deaths',
                        data: data.deaths_ys,
                        fill: true,
                        backgroundColor: 'rgba(105, 103, 103, 0.5)',
                        borderColor: 'rgb(105, 103, 103)',
                        borderWidth: 5,
                    } ],

                },
                options: {
                    legend: {
                        labels: {
                            fontSize: 17,
                            fontColor: "black",
                            fontStyle: "bold",
                            fontFamily: "Rubik"
                        }
                    },
                    title: {
                        display: true,
                        fontSize: 29,
                        text: "COVID-19 Outbreak over time",
                        fontColor: "black",
                        fontFamily: "Rubik"


                    },
                    scales: {
                        yAxes: [{
                            ticks: {
                                // Place commas appropriately
                                callback: function(value, index, values) {
                                    return value.toLocaleString();
                                },
                                fontSize: 15,
                                fontColor: "black",
                                fontFamily: "Rubik"
                            },
                            scaleLabel : {
                                display: true,
                                labelString: "# of People",
                                fontSize: 29,
                                fontColor: "black",
                                fontFamily: "Rubik"

                            }
                        }],
                        xAxes : [{
                            ticks: {
                                fontSize: 15,
                                fontColor: "black",
                                fontFamily: "Rubik"
                            },
                            scaleLabel : {
                                display: true,
                                labelString: "Dates",
                                fontSize: 29,
                                fontColor: "black",
                                fontFamily: "Rubik"

                            },
                            
                        }]
                        
                    }

                }
            
            });
        }

        async function getData(){
            const response = await fetch(api_url, {cache: "reload"});
            const data = await response.json();
            
            const latest_response = await fetch(latest_api);
            const latest_data = await latest_response.json();

            //start with global data
            const dataObj = [
                {
                country: "Global",
                confirmed : latest_data.cases,
                deaths : latest_data.deaths,
                recovered: latest_data.recovered,
                flag: "https://upload.wikimedia.org/wikipedia/commons/e/ef/International_Flag_of_Planet_Earth.svg"
                }
            ]
            console.log(dataObj)
            var cHTML = document.getElementById('confirmed');
            cHTML.innerHTML = latest_data.cases.toLocaleString();

            var dHTML = document.getElementById('dead');
            dHTML.innerHTML = latest_data.deaths.toLocaleString();

            var rHTML = document.getElementById('recovered');
            rHTML.innerHTML = latest_data.recovered.toLocaleString();

            //loop thru and store all data
            for (index in data){
                info = data[index];
                country_name = info.country;

                cases_info = {
                    confirmed : info.cases,
                    deaths : info.deaths,
                    recovered : info.recovered,
                    flag : info.countryInfo.flag
                }
                cases_info["country"] = country_name
                dataObj.push(cases_info)

            } 
            console.log(dataObj)
            //sort data by confirmed cases
            dataObj.sort(function(a, b){
                return b.confirmed - a.confirmed
            })
            return dataObj
            
        }
        
        async function getHistoricalData(){
            var xs = [];
            var cases_ys = [];
            var deaths_ys = [];

            const response = await fetch(historical_url, {cache: "reload"});
            const data = await response.json();

            date = new Date(Date.now()).toLocaleString().split(',')[0]
            date = date.replace(/(?=....$)../g,""); 

            current_day_data = await getData();

            const totalHistorical = {
     
            }
            for (index in data){
                info = data[index]
                timeline = info.timeline
                cases = timeline.cases
                deaths = timeline.deaths

                for (day in cases){
                    if (totalHistorical[day] === undefined){
                        totalHistorical[day] = {
                            cases: cases[day],
                            deaths: deaths[day]
                        }
                    }else{
                        totalHistorical[day].cases += cases[day]
                        totalHistorical[day].deaths += deaths[day]
                    }
                }

            }
            // add current date to graph
            totalHistorical[date] = {
                cases: current_day_data[0].confirmed,
                deaths: current_day_data[0].deaths
            }

            for (date in totalHistorical){
                xs.push(date)
                cases_ys.push(totalHistorical[date].cases)
                deaths_ys.push(totalHistorical[date].deaths)
            }
            

            xs = lessData(xs)
            cases_ys = lessData(cases_ys)
            deaths_ys = lessData(deaths_ys)

            return {xs, cases_ys, deaths_ys}
        }

        function lessData(array){
            for (var i = 2; i <= array.length; i += 2)
                array.splice(i, 1);
            return array
        }
        

        window.onscroll = function() {stickyFunction()};

        var navbar = document.getElementById("navbar");

        var sticky = navbar.offsetTop;

        function stickyFunction() {
            if (window.pageYOffset >= sticky) {
                navbar.classList.add("sticky")
            } else {
                navbar.classList.remove("sticky");
            }
        }
    </script>
    
</body>
</html>